{% extends 'base.html' %}
{% block content %}
    <h1>ShowNoodle</h1>

    <h3>Enter an artist and city</h3>
    <form> 
        Artist <input type="text" name="artist" id="artist">
        <p></p>
        City<input type="text" name="city" id="city">
        <p></p>
        <input type="submit" value="Search" id="search-shows">
    </form>

    <p></p>

    <div id="show-results">
         <p style="font-weight: bold" id="show-message"></p>
        <p></p>
        <p></p>
        <div id="event-results"></div>
        <p></p>
        <p></p>
        <h4 id="related-artists-for-artist"></h4>
        <div class="related-artists"></div>
    </div>

    <h3>My Saved Shows</h3>

    <p></p>
    <p></p>

<script src="http://code.jquery.com/jquery.js"></script>

<script>

function showEvents(result) {
    
    $(".related-artists-imgs").remove();
    $(".event").remove(); 
    var city = result.events[0][1]['city'];
    city = city.substring(0, city.length - 8);
    // var artist_name = result.related_artist_names_imgs[i][0].replace(/[_-]/g, " ");

    if (result.events.length < 1) {

        var artist_name = result.searched_artist_name_img[0].replace(/[_-]/g, " ");
        $("#show-message").text("Sorry, no shows found. Select another artist below to run a new search.");
        $("#related-artists-for-artist").text("Artists similar to "+artist_name);
    }

    else {
        var artist_name = result.searched_artist_name_img[0].replace(/[_-]/g, " ");
        $("#show-message").text("Shows for artists similar to "+artist_name); 
        $("#related-artists-for-artist").text("Artists similar to "+artist_name);
    }


    for (i=0; i< result.events.length; i++) {

            var event_name = result.events[i][1]['event_name'];
            var event_city = result.events[i][1]['city'];
            var songkick_link = result.events[i][1]['songkick_link'];

            var events = [event_name, event_city, songkick_link]

            $("#event-results").append("<p class='event' id='eventname'>"+events[0]+"</p>");
            $("#event-results").append("<p class='event'>"+events[1]+"</p>");
            $("#event-results").append("<a href="+events[2]+" class='event'>Buy Tickets</a>");
            $("#event-results").append("<p class='event'>---------------------------------------------------</p>");


        
     }

     for (i=0; i< result.related_artist_names_imgs.length; i++) {

        $('.related-artists').append("<span class='related-artists-imgs'><img id="+result.related_artist_names_imgs[i][0]+" src="+result.related_artist_names_imgs[i][1]+"></span>")

      }

      $('.related-artists-imgs').click(function() {

                alert("Hey!!!");
        });
    
    }; 



function findEvents(evt) {

    evt.preventDefault(); 

    var userInputs = {

        artist: $("#artist").val(), 
        city: $("#city").val()


    };

    $.get("/search-for-shows.json", 
        userInputs, 
        showEvents);

};

$('#search-shows').click(findEvents);



</script>



{% endblock %}