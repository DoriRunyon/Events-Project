{% extends 'base.html' %}
{% block content %}
    <h1>Noodle</h1>

    <h3>Enter an artist and city</h3>
    <form> 
        Artist <input type="text" name="artist" id="artist">
        <p></p>
        City<input type="text" name="city" id="city">
        <p></p>
        <input type="submit" value="Search" id="search-shows">
    </form>

    <p></p>

    <div id="show-results">
         <p style="font-weight: bold" id="show-message"></p>
        <p></p>
        <p></p>
        <div id="event-results"></div>
        <p></p>
        <p></p>
        <h4 id="related-artists-for-artist"></h4>
        <div class="related-artists"></div>
    </div>

    <h3>My Saved Shows</h3>

    <div class="user-saved-shows"></div>

    <p></p>
    <p></p>

<script src="http://code.jquery.com/jquery.js"></script>

<script>

function showEvents(result) {
 
    $(".related-artists-imgs").remove();
    $(".event").remove(); 
  

    if (result.events.length < 1) {

        var artist_name = result.searched_artist_name_img[0].replace(/[_-]/g, " ");
        $("#show-message").text("Sorry, no shows found. Select another artist below to run a new search.");
        $("#related-artists-for-artist").text("Artists similar to "+artist_name);
    }

    else {
        var artist_name = result.searched_artist_name_img[0].replace(/[_-]/g, " ");
        $("#show-message").text("Shows for artists similar to "+artist_name); 
        $("#related-artists-for-artist").text("Artists similar to "+artist_name);
    }


    for (i=0; i< result.events.length; i++) {

            var event_name = result.events[i][1]['event_name'];
            var event_city = result.events[i][1]['city'];
            var songkick_link = result.events[i][1]['songkick_link'];

            var eventContainer = $("<div class='event'></div>"); 

            var saveButton = $("<button></button>"); 
            saveButton.text("Save Show");
            saveButton.click(function(link) {
                return function(evt) {
                    saveShow();
                    console.log(link);
                };
            }(songkick_link));

            eventContainer.append("<p id='eventname'>"+event_name+"</p>");
            eventContainer.append("<p>"+event_city+"</p>");
            eventContainer.append("<a href="+songkick_link+">Buy Tickets</a>");
            eventContainer.append(saveButton);
            eventContainer.append("<hr/>");

            $("#event-results").append(eventContainer);


        
     }


     for (i=0; i< result.related_artist_names_imgs.length; i++) {

        $('.related-artists').append("<span class='related-artists-imgs'><img id="+result.related_artist_names_imgs[i][0]+" src="+result.related_artist_names_imgs[i][1]+"></span>")

      }

      $('.related-artists-imgs').click(function(evt) {
 
                var artist_name = evt.target.id.replace(/[_-]/g, " "); 
                $("#artist").val(artist_name)
                $("#city").val(); 
                alert("Hey this is gonna take a while.. sorry :(");
                getFormInputs()
        });
    
    }; 


function getFormInputs(evt) {

    if (evt) {
        evt.preventDefault(); 
    }

    findEvents($("#artist").val(), $("#city").val()); 

}

function findEvents(artist, city) {


    var userInputs = {'artist': artist, 'city': city}

    $.get("/search-for-shows.json", 
        userInputs, 
        showEvents);

};

// function saveShow(evt) {



//     $.get("/saved-shows.json",
//         )
// }

// function showUserSavedEvents(result) {


// }

$('#search-shows').click(getFormInputs);



</script>



{% endblock %}